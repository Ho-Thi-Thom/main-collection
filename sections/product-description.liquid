<link
  rel="stylesheet"
  href="{{ 'product-description.css' | asset_url }}"
  media="all"
>

{%- capture content -%}

  {%- for block in section.blocks -%}
    {%- if block.type == '@app' -%}
      {%- continue -%}{%- endif -%}
    {%- assign heading = block.settings.text -%}
    {%- assign body = block.settings.content -%}
    {%- case block.type -%}
      {%- when 'tab_heading' -%}
      {%- assign heading = block.settings.text -%}
      {%- capture body -%}
        {%- for childBlock in section.blocks offset: forloop.index -%}
          {%- unless childBlock.type == '@app' -%}
            {%- break -%}{%- endunless -%}
          {% render childBlock %}
        {%- endfor -%}
      {%- endcapture -%}
      {% comment %} {%- when 'description' -%} {% endcomment %}
      {% comment %} {%- liquid
        assign enable_multi_tab   = block.settings.enable_multi_tab
        assign description        = product.description
        assign descriptionCheck   = description | strip_html | strip
        assign description_parts  = description | strip_newlines | strip | split: "<h5"
      -%}

      {%- if descriptionCheck == blank -%}
        {%- continue -%}
      {%- endif -%}

      {% if enable_multi_tab != true %}
        {%- liquid
         assign heading = 'headingabc' | t
         assign body = description | split: '<h5>' | first
       -%}
        {% capture tab_header %}
          {% render 'snippet-description', type: 'tab_header', heading: heading %}
        {% endcapture %}
        {% capture tab_body %}
          {% render 'snippet-description', type: 'tab_body', heading: heading, body: body %}
        {% endcapture %}


      {% endif %}
      {% if enable_multi_tab %}{% endif %} {% endcomment %}
    {%- endcase -%}
  {% endfor %}

  <div class="product-section-description">
    <div class="section-container">
      <div class="tab__panel-wrapper">
        <div class="tab__panel-header">{{ heading }}</div>
        <div class="tab__panel-body">{{ body }}</div>
      </div>
    </div>
  </div> 

{% endcapture %}

{% comment %} <div class="container_wrapper"> {% endcomment %}
{{ content }}
{% comment %} </div> {% endcomment %}

{% schema %}
{
  "name": "Product Description",
  "class": "shopify-section-description",
  "tag": "section",
  "settings": [],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "tab_heading",
      "name": "Tab heading for apps",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Tab heading content",
          "default": "Tab heading"
        }
      ]
    },
    {
      "type": "description",
      "name": "Product Description",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "enable_multil_tab",
          "label": "Use Multi-tabs with heading 5 tag",
          "info": "We use heading 5 in Product's description to seperate Multi-tabs, each <h5>Tabs Title</h5> will be considered as content seperator and tabs title"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Description"
    }
  ]
}
{% endschema %}
