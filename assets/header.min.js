(()=>{function B(){let t=document.querySelector(".jsCartPopup"),e=document.querySelector(".jsCartPopup .popup__header-close");e&&e.addEventListener("click",()=>{t.classList.remove("active"),document.querySelector("#bg-color").classList.remove("body-overlay")})}B();function E(){document.querySelector(".jsCartPopup").classList.add("active"),document.querySelector("#bg-color").classList.add("body-overlay")}async function D(t){try{return await(await fetch(window.location.pathname+`?section_id=${t}`)).text()}catch(e){return e}}async function v(){let e=document.querySelector(".jsCartPopup").dataset.sectionId,n=await D(e),o=document.createElement("div");o.innerHTML=n;let u=o.querySelector(".jsCartPopup").querySelectorAll(".jsPopupUpdate");return document.querySelectorAll(".jsCartPopup .jsPopupUpdate").forEach((d,i)=>{d.parentNode.replaceChild(u[i],d)}),!0}function b(t="",e={},n){let o=new URLSearchParams(e);return n&&typeof n=="function"&&n(o),t?t+"?"+o.toString():window.location.pathname+"?"+o.toString()}function A(t,e,n=!0){t&&(t(),n&&document.addEventListener("shopify:section:load",o=>{o.detail.sectionId===e&&t()}))}function C(t){let e=document.querySelector("#popup-info"),n=document.querySelector("#popup-info .title"),o=document.querySelector("#popup-info .wrapper-content"),{type:c,title:u,textContent:l}=t;n.setAttribute("data-type",c),n.innerHTML=u.trim(),o.innerHTML=l.trim(),e.classList.add("active")}function g(t,e){var n=null;return function(){clearTimeout(n);var o=arguments,c=this;n=setTimeout(function(){t.apply(c,o)},e)}}function L(t,e,n,o=!1){let c=document.createElement("div");c.innerHTML=t;let u=document.querySelector(`li.cart__item.jsLineItem[data-line-index="${e}"]`);if(n)o||u.remove();else{let i=c.querySelector(`li.cart__item.jsLineItem[data-line-index="${e}"]`),m=u.querySelectorAll(".jsLineUpdate"),a=i.querySelectorAll(".jsLineUpdate");m.forEach((r,s)=>{r.parentNode.replaceChild(a[s],r)})}let l=document.querySelectorAll(".js-cart-update"),d=c.querySelectorAll(".js-cart-update");l.forEach((i,m)=>{i.parentNode.replaceChild(d[m],i)})}function T(t){fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:t})})}async function I(t){let{variantId:e,newQuantity:n,sectionId:o}=t;return await(await fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:n,sections:o})})).json()}function j(t,e,n){let o=document.querySelector(`.cart__item.jsLineItem[data-line-index="${n}"] .add__qlt`);switch(e){case"add":+t.value==+t.max&&(o.disabled=!0);break;case"remove":o.disabled=!1;break;default:break}}function k(){document.querySelectorAll(".jsLineItem").forEach(e=>{let n=e.querySelector(".quantity__input"),o=parseInt(n.getAttribute("max")),c=e.querySelector(".add__qlt");n.value===o.toString()?c.disabled=!0:c.disabled=!1})}async function J(){try{return(await(await fetch(window.Shopify.routes.root+"cart.js")).json()).item_count}catch(t){return t}}async function U(){try{let t=await J(),e=document.querySelector(".jsCountItemCart");return e.textContent=t,t}catch(t){console.error(t)}}var q=document.querySelector(".cart-section-wrapper")?.dataset.sectionId;q&&A(_,q);function _(t=!0,e=!1){let n=document.querySelectorAll(".cart__item .remove__qlt"),o=document.querySelectorAll(".cart__item .add__qlt"),c=document.querySelectorAll(".btn-remove");k(),u(c),u([...o,...n]);function u(a=[]){!a||a.length===0||a.forEach(r=>{let s=null;r.addEventListener("click",f=>{let y=f.target,h=y.closest(".cart__item.jsLineItem").dataset.lineIndex,p=document.querySelector(`.cart__item.jsLineItem[data-line-index="${h}"] .quantity__input`);y.classList.contains("add__qlt")&&(p.stepUp(),j(p,"add",h)),y.classList.contains("remove__qlt")&&(p.stepDown(),j(p,"remove",h));let S=p.value,w=y.classList.contains("btn-remove");w&&(S=0),s&&clearTimeout(s),s=setTimeout(async()=>{p.value;let x=p.getAttribute("data-sections"),R={variantId:p.getAttribute("data-key"),newQuantity:S,sectionId:x};try{let H=(await I(R)).sections[x];await U()?L(H,h,checkRemove=w):e?v():location.reload()}catch(P){console.log("Error",P)}},1e3)})})}document.querySelectorAll(".cart__item .quantity__input").forEach(function(a){a.addEventListener("keydown",function(r){r.key==="Enter"&&r.preventDefault()}),a.addEventListener("input",g(async r=>{let s=r.target.closest(".cart__item.jsLineItem").dataset.lineIndex,f=r.target,h={variantId:f.getAttribute("data-key"),newQuantity:f.value,sectionId:q};try{let S=(await I(h)).sections[q];L(S,s)}catch(p){let S={type:"error",title:"422",textContent:`Only ${f.getAttribute("max")} products in stock`};C(S)}},2e3))}),document.querySelectorAll(".accordion-initialized").forEach(function(a){let r=a.querySelector(".accordion-trigger"),s=a.querySelector(".cart__form-note");r.addEventListener("click",function(){s.classList.toggle("active")})});let i=document.getElementById("cart-note"),m=g(()=>T(i.value),500);i.addEventListener("input",m),t&&$()}function $(){let t=document.getElementsByName("shipping_address[country]")[0];t.addEventListener("change",function(c){let l=t.options[t.selectedIndex].getAttribute("data-provinces"),d=document.querySelector(".jsProvince"),i=d.querySelector("[name='shipping_address[province]']");JSON.parse(l).length?(JSON.parse(l).forEach(([m,a])=>{let r=document.createElement("option");r.value=m,r.text=a,i.appendChild(r)}),d.style.display="block"):d.style.display="none"});let n=document.querySelector(".jsShippingRates").dataset.url;document.querySelector(".shipping-form").addEventListener("submit",c=>{c.preventDefault();let u=Object.fromEntries(new FormData(c.target).entries()),l=document.querySelector(".jsButtonShipping");l.classList.add("loading");let d=b(n,u),i=document.querySelector(".js-shipping-result"),m=document.querySelector("template").content.firstElementChild,a=document.createElement("div");i.innerHTML="",fetch(d).then(r=>r.json()).then(r=>{let s=r.shipping_rates,f=theme.strings.notFoundShippingRate;s&&s.length>1?f=theme.strings.manyShippingRate.replace("{{ number }}",s.length):s&&s.length===1&&(f=theme.strings.oneShippingRate),document.querySelector(".js-response-title").innerHTML=f,s&&s.forEach(y=>{a.innerHTML=m.outerHTML,a.querySelector(".shipping-name").innerHTML=y.name,a.querySelector(".shipping-cost").textContent=y.price,i.insertAdjacentHTML("beforeend",a.innerHTML)}),l.classList.remove("loading")})})}var F=document.querySelector(".header-bugger"),O=document.querySelector(".header-menu"),V=document.querySelector(".header-close"),N=document.querySelector("#bg-color");M(F,function(){O.classList.toggle("active"),N.classList.toggle("body-overlay")});M(V,function(){O.classList.remove("active"),N.classList.remove("body-overlay")});function M(t,e){t.addEventListener("click",e)}var Q=document.querySelector(".jsViewPopupCart");Q.addEventListener("click",async()=>{await v()&&(g(E(),500),_(!1,!0))});})();
