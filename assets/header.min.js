(()=>{function H(){let t=document.querySelector(".jsCartPopup"),e=document.querySelector(".jsCartPopup .popup__header-close");e&&e.addEventListener("click",()=>{t.classList.remove("active"),document.querySelector("#bg-color").classList.remove("body-overlay")})}H();function P(){document.querySelector(".jsCartPopup").classList.add("active"),document.querySelector("#bg-color").classList.add("body-overlay")}async function B(t){try{return await(await fetch(window.location.pathname+`?section_id=${t}`)).text()}catch(e){return e}}async function v(){let e=document.querySelector(".jsCartPopup").dataset.sectionId,n=await B(e),o=document.createElement("div");o.innerHTML=n;let u=o.querySelector(".jsCartPopup").querySelectorAll(".jsPopupUpdate");return document.querySelectorAll(".jsCartPopup .jsPopupUpdate").forEach((l,i)=>{l.parentNode.replaceChild(u[i],l)}),!0}function E(t="",e={},n){let o=new URLSearchParams(e);return n&&typeof n=="function"&&n(o),t?t+"?"+o.toString():window.location.pathname+"?"+o.toString()}function b(t,e,n=!0){t&&(t(),n&&document.addEventListener("shopify:section:load",o=>{o.detail.sectionId===e&&t()}))}function S(t,e){var n=null;return function(){clearTimeout(n);var o=arguments,s=this;n=setTimeout(function(){t.apply(s,o)},e)}}function C(t,e,n,o=!1){let s=document.createElement("div");s.innerHTML=t;let u=document.querySelector(`li.cart__item.jsLineItem[data-line-index="${e}"]`);if(n)o||u.remove();else{let i=s.querySelector(`li.cart__item.jsLineItem[data-line-index="${e}"]`),m=u.querySelectorAll(".jsLineUpdate"),c=i.querySelectorAll(".jsLineUpdate");m.forEach((r,a)=>{r.parentNode.replaceChild(c[a],r)})}let p=document.querySelectorAll(".js-cart-update"),l=s.querySelectorAll(".js-cart-update");p.forEach((i,m)=>{i.parentNode.replaceChild(l[m],i)})}function A(t){fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:t})})}async function L(t){let{variantId:e,newQuantity:n,sectionId:o}=t;return await(await fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:n,sections:o})})).json()}function I(t,e,n){let o=document.querySelector(`.cart__item.jsLineItem[data-line-index="${n}"] .add__qlt`);switch(e){case"add":+t.value==+t.max&&(o.disabled=!0);break;case"remove":o.disabled=!1;break;default:break}}function T(){document.querySelectorAll(".jsLineItem").forEach(e=>{let n=e.querySelector(".quantity__input"),o=parseInt(n.getAttribute("max")),s=e.querySelector(".add__qlt");n.value===o.toString()?s.disabled=!0:s.disabled=!1})}async function D(){try{return(await(await fetch(window.Shopify.routes.root+"cart.js")).json()).item_count}catch(t){return t}}async function k(){try{let t=await D(),e=document.querySelector(".jsCountItemCart");return e.textContent=t,t}catch(t){console.error(t)}}var q=document.querySelector(".cart-section-wrapper")?.dataset.sectionId;q&&b(j,q);function j(t=!0,e=!1){let n=document.querySelectorAll(".cart__item .remove__qlt"),o=document.querySelectorAll(".cart__item .add__qlt"),s=document.querySelectorAll(".btn-remove");T(),u(s),u([...o,...n]);function u(c=[]){!c||c.length===0||c.forEach(r=>{let a=null;r.addEventListener("click",f=>{let y=f.target,h=y.closest(".cart__item.jsLineItem").dataset.lineIndex,d=document.querySelector(`.cart__item.jsLineItem[data-line-index="${h}"] .quantity__input`);y.classList.contains("add__qlt")&&(d.stepUp(),I(d,"add",h)),y.classList.contains("remove__qlt")&&(d.stepDown(),I(d,"remove",h));let g=d.value,_=y.classList.contains("btn-remove");_&&(g=0),a&&clearTimeout(a),a=setTimeout(async()=>{d.value;let w=d.getAttribute("data-sections"),M={variantId:d.getAttribute("data-key"),newQuantity:g,sectionId:w};try{let R=(await L(M)).sections[w];await k()?C(R,h,checkRemove=_):e?v():location.reload()}catch(x){console.log("Error",x)}},1e3)})})}document.querySelectorAll(".cart__item .quantity__input").forEach(function(c){c.addEventListener("keydown",function(r){r.key==="Enter"&&r.preventDefault()}),c.addEventListener("input",S(async r=>{let a=r.target.closest(".cart__item.jsLineItem").dataset.lineIndex,f=r.target,h={variantId:f.getAttribute("data-key"),newQuantity:f.value,sectionId:q};try{let g=(await L(h)).sections[q];C(g,a)}catch(d){}},2e3))}),document.querySelectorAll(".accordion-initialized").forEach(function(c){let r=c.querySelector(".accordion-trigger"),a=c.querySelector(".cart__form-note");r.addEventListener("click",function(){a.classList.toggle("active")})});let i=document.getElementById("cart-note"),m=S(()=>A(i.value),500);i.addEventListener("input",m),t&&J()}function J(){let t=document.getElementsByName("shipping_address[country]")[0];t.addEventListener("change",function(s){let p=t.options[t.selectedIndex].getAttribute("data-provinces"),l=document.querySelector(".jsProvince"),i=l.querySelector("[name='shipping_address[province]']");JSON.parse(p).length?(JSON.parse(p).forEach(([m,c])=>{let r=document.createElement("option");r.value=m,r.text=c,i.appendChild(r)}),l.style.display="block"):l.style.display="none"});let n=document.querySelector(".jsShippingRates").dataset.url;document.querySelector(".shipping-form").addEventListener("submit",s=>{s.preventDefault();let u=Object.fromEntries(new FormData(s.target).entries()),p=document.querySelector(".jsButtonShipping");p.classList.add("loading");let l=E(n,u),i=document.querySelector(".js-shipping-result"),m=document.querySelector("template").content.firstElementChild,c=document.createElement("div");i.innerHTML="",fetch(l).then(r=>r.json()).then(r=>{let a=r.shipping_rates,f=theme.strings.notFoundShippingRate;a&&a.length>1?f=theme.strings.manyShippingRate.replace("{{ number }}",a.length):a&&a.length===1&&(f=theme.strings.oneShippingRate),document.querySelector(".js-response-title").innerHTML=f,a&&a.forEach(y=>{c.innerHTML=m.outerHTML,c.querySelector(".shipping-name").innerHTML=y.name,c.querySelector(".shipping-cost").textContent=y.price,i.insertAdjacentHTML("beforeend",c.innerHTML)}),p.classList.remove("loading")})})}var F=document.querySelector(".header-bugger"),U=document.querySelector(".header-menu"),$=document.querySelector(".header-close"),N=document.querySelector("#bg-color");O(F,function(){U.classList.toggle("active"),N.classList.toggle("body-overlay")});O($,function(){U.classList.remove("active"),N.classList.remove("body-overlay")});function O(t,e){t.addEventListener("click",e)}var V=document.querySelector(".jsViewPopupCart");V.addEventListener("click",async()=>{await v()&&(S(P(),500),j(!1,!0))});})();
