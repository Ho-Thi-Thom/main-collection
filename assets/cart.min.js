(()=>{function _(t,n){let e=document.createElement("div");e.innerHTML=t;let o=document.querySelector(`li.cart__item.jsLineItem[data-line-index="${n}"]`),m=e.querySelector(`li.cart__item.jsLineItem[data-line-index="${n}"]`),y=o.querySelectorAll(".jsLineUpdate"),q=m.querySelectorAll(".jsLineUpdate"),h=document.querySelectorAll(".js-cart-update"),j=e.querySelectorAll(".js-cart-update");y.forEach((f,S)=>{f.parentNode.replaceChild(q[S],f)}),h.forEach((f,S)=>{f.parentNode.replaceChild(j[S],f)})}function E(t){fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:t})})}async function L(t){let{variantId:n,newQuantity:e,sectionId:o}=t;return await(await fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n,quantity:e,sections:o})})).json()}function v(t,n,e){let o=document.querySelector(`.cart__item.jsLineItem[data-line-index="${e}"] .add__qlt`);switch(n){case"add":+t.value==+t.max&&(o.disabled=!0);break;case"remove":o.disabled=!1;break;default:break}}function b(){document.querySelectorAll(".jsLineItem").forEach(n=>{let e=n.querySelector(".quantity__input"),o=parseInt(e.getAttribute("max")),m=n.querySelector(".add__qlt");e.value===o.toString()?m.disabled=!0:m.disabled=!1})}function A(t="",n={},e){let o=new URLSearchParams(n);return e&&typeof e=="function"&&e(o),t?t+"?"+o.toString():window.location.pathname+"?"+o.toString()}function T(t,n,e=!0){t&&(t(),e&&document.addEventListener("shopify:section:load",o=>{o.detail.sectionId===n&&t()}))}function x(t,n){var e=null;return function(){clearTimeout(e);var o=arguments,m=this;e=setTimeout(function(){t.apply(m,o)},n)}}async function N(){try{return(await(await fetch(window.Shopify.routes.root+"cart.js")).json()).item_count}catch(t){return t}}async function O(){try{let t=await N(),n=document.querySelector(".jsCountItemCart");n.textContent=t}catch(t){console.error(t)}}var w=document.querySelector(".cart-section-wrapper").dataset.sectionId;T(P,w);function P(){b();let t=document.querySelectorAll(".cart__item .remove__qlt"),n=document.querySelectorAll(".cart__item .add__qlt");e([...n,...t]);function e(a=[]){!a||a.length===0||a.forEach(i=>{let c=null;i.addEventListener("click",d=>{let p=d.target,u=p.closest(".cart__item.jsLineItem").dataset.lineIndex,r=document.querySelector(`.cart__item.jsLineItem[data-line-index="${u}"] .quantity__input`);p.classList.contains("add__qlt")&&(r.stepUp(),v(r,"add",u)),p.classList.contains("remove__qlt")&&(r.stepDown(),v(r,"remove",u)),c&&clearTimeout(c),c=setTimeout(async()=>{let s=r.value,l=r.getAttribute("data-sections"),I={variantId:r.getAttribute("data-key"),newQuantity:s,sectionId:l};try{let U=(await L(I)).sections[l];_(U,u),O()}catch(C){console.log(C)}},1e3)})})}document.querySelectorAll(".cart__item .quantity__input").forEach(function(a){a.addEventListener("keydown",function(i){i.key==="Enter"&&i.preventDefault()}),a.addEventListener("input",x(async i=>{let c=i.target.closest(".cart__item.jsLineItem").dataset.lineIndex,d=i.target,u={variantId:d.getAttribute("data-key"),newQuantity:d.value,sectionId:w};try{let s=(await L(u)).sections[w];_(s,c)}catch(r){}},2e3))}),document.querySelectorAll(".accordion-initialized").forEach(function(a){let i=a.querySelector(".accordion-trigger"),c=a.querySelector(".cart__form-note");i.addEventListener("click",function(){c.classList.toggle("active")})});let y=document.getElementById("cart-note"),q=x(()=>E(y.value),500);y.addEventListener("input",q);let h=document.getElementsByName("shipping_address[country]")[0];h.addEventListener("change",function(a){let c=h.options[h.selectedIndex].getAttribute("data-provinces"),d=document.querySelector(".jsProvince"),p=d.querySelector("[name='shipping_address[province]']");JSON.parse(c).length?(JSON.parse(c).forEach(([u,r])=>{let s=document.createElement("option");s.value=u,s.text=r,p.appendChild(s)}),d.style.display="block"):d.style.display="none"});let f=document.querySelector(".jsShippingRates").dataset.url;document.querySelector(".shipping-form").addEventListener("submit",a=>{a.preventDefault();let i=Object.fromEntries(new FormData(a.target).entries()),c=document.querySelector(".jsButtonShipping");c.classList.add("loading");let d=A(f,i),p=document.querySelector(".js-shipping-result"),u=document.querySelector("template").content.firstElementChild,r=document.createElement("div");p.innerHTML="",fetch(d).then(s=>s.json()).then(s=>{let l=s.shipping_rates,g=theme.strings.notFoundShippingRate;l&&l.length>1?g=theme.strings.manyShippingRate.replace("{{ number }}",l.length):l&&l.length===1&&(g=theme.strings.oneShippingRate),document.querySelector(".js-response-title").innerHTML=g,l&&l.forEach(I=>{r.innerHTML=u.outerHTML,r.querySelector(".shipping-name").innerHTML=I.name,r.querySelector(".shipping-cost").textContent=I.price,p.insertAdjacentHTML("beforeend",r.innerHTML)}),c.classList.remove("loading")})})}})();
