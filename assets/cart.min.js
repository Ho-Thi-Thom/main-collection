(()=>{function q(t,n,o){let e=document.createElement("div");e.innerHTML=t;let m=document.querySelector(`li.cart__item.jsLineItem[data-line-index="${n}"]`);if(o)m.remove();else{let y=e.querySelector(`li.cart__item.jsLineItem[data-line-index="${n}"]`),f=m.querySelectorAll(".jsLineUpdate"),j=y.querySelectorAll(".jsLineUpdate");f.forEach((g,C)=>{g.parentNode.replaceChild(j[C],g)})}let I=document.querySelectorAll(".js-cart-update"),S=e.querySelectorAll(".js-cart-update");I.forEach((y,f)=>{y.parentNode.replaceChild(S[f],y)})}function b(t){fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:t})})}async function _(t){let{variantId:n,newQuantity:o,sectionId:e}=t;return await(await fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n,quantity:o,sections:e})})).json()}function L(t,n,o){let e=document.querySelector(`.cart__item.jsLineItem[data-line-index="${o}"] .add__qlt`);switch(n){case"add":+t.value==+t.max&&(e.disabled=!0);break;case"remove":e.disabled=!1;break;default:break}}function A(){document.querySelectorAll(".jsLineItem").forEach(n=>{let o=n.querySelector(".quantity__input"),e=parseInt(o.getAttribute("max")),m=n.querySelector(".add__qlt");o.value===e.toString()?m.disabled=!0:m.disabled=!1})}function T(t="",n={},o){let e=new URLSearchParams(n);return o&&typeof o=="function"&&o(e),t?t+"?"+e.toString():window.location.pathname+"?"+e.toString()}function O(t,n,o=!0){t&&(t(),o&&document.addEventListener("shopify:section:load",e=>{e.detail.sectionId===n&&t()}))}function x(t,n){var o=null;return function(){clearTimeout(o);var e=arguments,m=this;o=setTimeout(function(){t.apply(m,e)},n)}}async function k(){try{return(await(await fetch(window.Shopify.routes.root+"cart.js")).json()).item_count}catch(t){return t}}async function U(){try{let t=await k(),n=document.querySelector(".jsCountItemCart");n.textContent=t}catch(t){console.error(t)}}var w=document.querySelector(".cart-section-wrapper").dataset.sectionId;O(M,w);function M(){A();let t=document.querySelectorAll(".cart__item .remove__qlt"),n=document.querySelectorAll(".cart__item .add__qlt"),o=document.querySelectorAll(".btn-remove");e(o),e([...n,...t]);function e(c=[]){!c||c.length===0||c.forEach(i=>{let a=null;i.addEventListener("click",d=>{let u=d.target,l=u.closest(".cart__item.jsLineItem").dataset.lineIndex,r=document.querySelector(`.cart__item.jsLineItem[data-line-index="${l}"] .quantity__input`);u.classList.contains("add__qlt")&&(r.stepUp(),L(r,"add",l)),u.classList.contains("remove__qlt")&&(r.stepDown(),L(r,"remove",l));let s=r.value,p=u.classList.contains("btn-remove");p&&(s=0),a&&clearTimeout(a),a=setTimeout(async()=>{r.value;let h=r.getAttribute("data-sections"),N={variantId:r.getAttribute("data-key"),newQuantity:s,sectionId:h};try{let P=(await _(N)).sections[h];q(P,l,checkRemove=p),U()}catch(E){console.log(E)}},1e3)})})}document.querySelectorAll(".cart__item .quantity__input").forEach(function(c){c.addEventListener("keydown",function(i){i.key==="Enter"&&i.preventDefault()}),c.addEventListener("input",x(async i=>{let a=i.target.closest(".cart__item.jsLineItem").dataset.lineIndex,d=i.target,l={variantId:d.getAttribute("data-key"),newQuantity:d.value,sectionId:w};try{let s=(await _(l)).sections[w];q(s,a)}catch(r){}},2e3))}),document.querySelectorAll(".accordion-initialized").forEach(function(c){let i=c.querySelector(".accordion-trigger"),a=c.querySelector(".cart__form-note");i.addEventListener("click",function(){a.classList.toggle("active")})});let S=document.getElementById("cart-note"),y=x(()=>b(S.value),500);S.addEventListener("input",y);let f=document.getElementsByName("shipping_address[country]")[0];f.addEventListener("change",function(c){let a=f.options[f.selectedIndex].getAttribute("data-provinces"),d=document.querySelector(".jsProvince"),u=d.querySelector("[name='shipping_address[province]']");JSON.parse(a).length?(JSON.parse(a).forEach(([l,r])=>{let s=document.createElement("option");s.value=l,s.text=r,u.appendChild(s)}),d.style.display="block"):d.style.display="none"});let g=document.querySelector(".jsShippingRates").dataset.url;document.querySelector(".shipping-form").addEventListener("submit",c=>{c.preventDefault();let i=Object.fromEntries(new FormData(c.target).entries()),a=document.querySelector(".jsButtonShipping");a.classList.add("loading");let d=T(g,i),u=document.querySelector(".js-shipping-result"),l=document.querySelector("template").content.firstElementChild,r=document.createElement("div");u.innerHTML="",fetch(d).then(s=>s.json()).then(s=>{let p=s.shipping_rates,h=theme.strings.notFoundShippingRate;p&&p.length>1?h=theme.strings.manyShippingRate.replace("{{ number }}",p.length):p&&p.length===1&&(h=theme.strings.oneShippingRate),document.querySelector(".js-response-title").innerHTML=h,p&&p.forEach(v=>{r.innerHTML=l.outerHTML,r.querySelector(".shipping-name").innerHTML=v.name,r.querySelector(".shipping-cost").textContent=v.price,u.insertAdjacentHTML("beforeend",r.innerHTML)}),a.classList.remove("loading")})})}})();
