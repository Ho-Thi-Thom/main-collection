(()=>{function w(t="",e={},n){let o=new URLSearchParams(e);return n&&typeof n=="function"&&n(o),t?t+"?"+o.toString():window.location.pathname+"?"+o.toString()}function C(t,e,n=!0){t&&(t(),n&&document.addEventListener("shopify:section:load",o=>{o.detail.sectionId===e&&t()}))}function g(t,e){var n=null;return function(){clearTimeout(n);var o=arguments,c=this;n=setTimeout(function(){t.apply(c,o)},e)}}function I(t,e,n){let o=document.createElement("div");o.innerHTML=t;let c=document.querySelector(`li.cart__item.jsLineItem[data-line-index="${e}"]`);if(n)c.remove();else{let s=o.querySelector(`li.cart__item.jsLineItem[data-line-index="${e}"]`),u=c.querySelectorAll(".jsLineUpdate"),i=s.querySelectorAll(".jsLineUpdate");u.forEach((r,a)=>{r.parentNode.replaceChild(i[a],r)})}let h=document.querySelectorAll(".js-cart-update"),f=o.querySelectorAll(".js-cart-update");h.forEach((s,u)=>{s.parentNode.replaceChild(f[u],s)})}function j(t){fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:t})})}async function q(t){let{variantId:e,newQuantity:n,sectionId:o}=t;return await(await fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:n,sections:o})})).json()}function _(t,e,n){let o=document.querySelector(`.cart__item.jsLineItem[data-line-index="${n}"] .add__qlt`);switch(e){case"add":+t.value==+t.max&&(o.disabled=!0);break;case"remove":o.disabled=!1;break;default:break}}function E(){document.querySelectorAll(".jsLineItem").forEach(e=>{let n=e.querySelector(".quantity__input"),o=parseInt(n.getAttribute("max")),c=e.querySelector(".add__qlt");n.value===o.toString()?c.disabled=!0:c.disabled=!1})}async function P(){try{return(await(await fetch(window.Shopify.routes.root+"cart.js")).json()).item_count}catch(t){return t}}async function b(){try{let t=await P(),e=document.querySelector(".jsCountItemCart");e.textContent=t}catch(t){console.error(t)}}var S=document.querySelector(".cart-section-wrapper")?.dataset.sectionId;S&&C(O,S);function O(t=!0){let e=document.querySelectorAll(".cart__item .remove__qlt"),n=document.querySelectorAll(".cart__item .add__qlt"),o=document.querySelectorAll(".btn-remove");E(),c(o),c([...n,...e]);function c(i=[]){!i||i.length===0||i.forEach(r=>{let a=null;r.addEventListener("click",d=>{let p=d.target,m=p.closest(".cart__item.jsLineItem").dataset.lineIndex,l=document.querySelector(`.cart__item.jsLineItem[data-line-index="${m}"] .quantity__input`);p.classList.contains("add__qlt")&&(l.stepUp(),_(l,"add",m)),p.classList.contains("remove__qlt")&&(l.stepDown(),_(l,"remove",m));let y=l.value,v=p.classList.contains("btn-remove");v&&(y=0),a&&clearTimeout(a),a=setTimeout(async()=>{l.value;let L=l.getAttribute("data-sections"),A={variantId:l.getAttribute("data-key"),newQuantity:y,sectionId:L};try{let T=(await q(A)).sections[L];I(T,m,checkRemove=v),b()}catch(x){console.log(x)}},1e3)})})}document.querySelectorAll(".cart__item .quantity__input").forEach(function(i){i.addEventListener("keydown",function(r){r.key==="Enter"&&r.preventDefault()}),i.addEventListener("input",g(async r=>{let a=r.target.closest(".cart__item.jsLineItem").dataset.lineIndex,d=r.target,m={variantId:d.getAttribute("data-key"),newQuantity:d.value,sectionId:S};try{let y=(await q(m)).sections[S];I(y,a)}catch(l){}},2e3))}),document.querySelectorAll(".accordion-initialized").forEach(function(i){let r=i.querySelector(".accordion-trigger"),a=i.querySelector(".cart__form-note");r.addEventListener("click",function(){a.classList.toggle("active")})});let s=document.getElementById("cart-note"),u=g(()=>j(s.value),500);s.addEventListener("input",u),t&&U()}function U(){let t=document.getElementsByName("shipping_address[country]")[0];t.addEventListener("change",function(c){let f=t.options[t.selectedIndex].getAttribute("data-provinces"),s=document.querySelector(".jsProvince"),u=s.querySelector("[name='shipping_address[province]']");JSON.parse(f).length?(JSON.parse(f).forEach(([i,r])=>{let a=document.createElement("option");a.value=i,a.text=r,u.appendChild(a)}),s.style.display="block"):s.style.display="none"});let n=document.querySelector(".jsShippingRates").dataset.url;document.querySelector(".shipping-form").addEventListener("submit",c=>{c.preventDefault();let h=Object.fromEntries(new FormData(c.target).entries()),f=document.querySelector(".jsButtonShipping");f.classList.add("loading");let s=w(n,h),u=document.querySelector(".js-shipping-result"),i=document.querySelector("template").content.firstElementChild,r=document.createElement("div");u.innerHTML="",fetch(s).then(a=>a.json()).then(a=>{let d=a.shipping_rates,p=theme.strings.notFoundShippingRate;d&&d.length>1?p=theme.strings.manyShippingRate.replace("{{ number }}",d.length):d&&d.length===1&&(p=theme.strings.oneShippingRate),document.querySelector(".js-response-title").innerHTML=p,d&&d.forEach(m=>{r.innerHTML=i.outerHTML,r.querySelector(".shipping-name").innerHTML=m.name,r.querySelector(".shipping-cost").textContent=m.price,u.insertAdjacentHTML("beforeend",r.innerHTML)}),f.classList.remove("loading")})})}})();
