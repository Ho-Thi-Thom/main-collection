(()=>{function k(){let t=document.querySelector(".jsCartPopup"),e=document.querySelector(".jsCartPopup .popup__header-close");e&&e.addEventListener("click",()=>{t.classList.remove("active"),document.querySelector("#bg-color").classList.remove("body-overlay")})}k();async function N(t){try{return await(await fetch(window.location.pathname+`?section_id=${t}`)).text()}catch(e){return e}}async function w(){let e=document.querySelector(".jsCartPopup").dataset.sectionId,n=await N(e),o=document.createElement("div");o.innerHTML=n;let u=o.querySelector(".jsCartPopup").querySelectorAll(".jsPopupUpdate");return document.querySelectorAll(".jsCartPopup .jsPopupUpdate").forEach((d,i)=>{d.parentNode.replaceChild(u[i],d)}),!0}function E(t="",e={},n){let o=new URLSearchParams(e);return n&&typeof n=="function"&&n(o),t?t+"?"+o.toString():window.location.pathname+"?"+o.toString()}function P(t,e,n=!0){t&&(t(),n&&document.addEventListener("shopify:section:load",o=>{o.detail.sectionId===e&&t()}))}function v(t){let e=document.querySelector("#popup-info"),n=document.querySelector("#popup-info .title"),o=document.querySelector("#popup-info .wrapper-content"),{type:a,title:u,textContent:l}=t;n.setAttribute("data-type",a),n.innerHTML=u.trim(),o.innerHTML=l.trim(),e.classList.add("active")}function q(t,e){var n=null;return function(){clearTimeout(n);var o=arguments,a=this;n=setTimeout(function(){t.apply(a,o)},e)}}function C(t,e,n,o=!1){let a=document.createElement("div");a.innerHTML=t;let u=document.querySelector(`li.cart__item.jsLineItem[data-line-index="${e}"]`);if(n)o||u.remove();else{let i=a.querySelector(`li.cart__item.jsLineItem[data-line-index="${e}"]`),m=u.querySelectorAll(".jsLineUpdate"),c=i.querySelectorAll(".jsLineUpdate");m.forEach((r,s)=>{r.parentNode.replaceChild(c[s],r)})}let l=document.querySelectorAll(".js-cart-update"),d=a.querySelectorAll(".js-cart-update");l.forEach((i,m)=>{i.parentNode.replaceChild(d[m],i)})}function b(t){fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:t})})}async function I(t){let{variantId:e,newQuantity:n,sectionId:o}=t;return await(await fetch("/cart/change.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:n,sections:o})})).json()}function L(t,e,n){let o=document.querySelector(`.cart__item.jsLineItem[data-line-index="${n}"] .add__qlt`);switch(e){case"add":+t.value==+t.max&&(o.disabled=!0);break;case"remove":o.disabled=!1;break;default:break}}function A(){document.querySelectorAll(".jsLineItem").forEach(e=>{let n=e.querySelector(".quantity__input"),o=parseInt(n.getAttribute("max")),a=e.querySelector(".add__qlt");n.value===o.toString()?a.disabled=!0:a.disabled=!1})}async function M(){try{return(await(await fetch(window.Shopify.routes.root+"cart.js")).json()).item_count}catch(t){return t}}async function T(){try{let t=await M(),e=document.querySelector(".jsCountItemCart");return e.textContent=t,t}catch(t){console.error(t)}}var g=document.querySelector(".cart-section-wrapper")?.dataset.sectionId;g&&P(R,g);function R(t=!0,e=!1){let n=document.querySelectorAll(".cart__item .remove__qlt"),o=document.querySelectorAll(".cart__item .add__qlt"),a=document.querySelectorAll(".btn-remove");A(),u(a),u([...o,...n]);function u(c=[]){!c||c.length===0||c.forEach(r=>{let s=null;r.addEventListener("click",f=>{let y=f.target,h=y.closest(".cart__item.jsLineItem").dataset.lineIndex,p=document.querySelector(`.cart__item.jsLineItem[data-line-index="${h}"] .quantity__input`);y.classList.contains("add__qlt")&&(p.stepUp(),L(p,"add",h)),y.classList.contains("remove__qlt")&&(p.stepDown(),L(p,"remove",h));let S=p.value,_=y.classList.contains("btn-remove");_&&(S=0),s&&clearTimeout(s),s=setTimeout(async()=>{p.value;let j=p.getAttribute("data-sections"),U={variantId:p.getAttribute("data-key"),newQuantity:S,sectionId:j};try{let O=(await I(U)).sections[j];await T()?C(O,h,checkRemove=_):e?w():location.reload()}catch(x){console.log("Error",x)}},1e3)})})}document.querySelectorAll(".cart__item .quantity__input").forEach(function(c){c.addEventListener("keydown",function(r){r.key==="Enter"&&r.preventDefault()}),c.addEventListener("input",q(async r=>{let s=r.target.closest(".cart__item.jsLineItem").dataset.lineIndex,f=r.target,h={variantId:f.getAttribute("data-key"),newQuantity:f.value,sectionId:g};try{let S=(await I(h)).sections[g];C(S,s)}catch(p){let S={type:"error",title:"422",textContent:`Only ${f.getAttribute("max")} products in stock`};v(S)}},2e3))}),document.querySelectorAll(".accordion-initialized").forEach(function(c){let r=c.querySelector(".accordion-trigger"),s=c.querySelector(".cart__form-note");r.addEventListener("click",function(){s.classList.toggle("active")})});let i=document.getElementById("cart-note"),m=q(()=>b(i.value),500);i.addEventListener("input",m),t&&H()}function H(){let t=document.getElementsByName("shipping_address[country]")[0];t.addEventListener("change",function(a){let l=t.options[t.selectedIndex].getAttribute("data-provinces"),d=document.querySelector(".jsProvince"),i=d.querySelector("[name='shipping_address[province]']");JSON.parse(l).length?(JSON.parse(l).forEach(([m,c])=>{let r=document.createElement("option");r.value=m,r.text=c,i.appendChild(r)}),d.style.display="block"):d.style.display="none"});let n=document.querySelector(".jsShippingRates").dataset.url;document.querySelector(".shipping-form").addEventListener("submit",a=>{a.preventDefault();let u=Object.fromEntries(new FormData(a.target).entries()),l=document.querySelector(".jsButtonShipping");l.classList.add("loading");let d=E(n,u),i=document.querySelector(".js-shipping-result"),m=document.querySelector("template").content.firstElementChild,c=document.createElement("div");i.innerHTML="",fetch(d).then(r=>r.json()).then(r=>{let s=r.shipping_rates,f=theme.strings.notFoundShippingRate;s&&s.length>1?f=theme.strings.manyShippingRate.replace("{{ number }}",s.length):s&&s.length===1&&(f=theme.strings.oneShippingRate),document.querySelector(".js-response-title").innerHTML=f,s&&s.forEach(y=>{c.innerHTML=m.outerHTML,c.querySelector(".shipping-name").innerHTML=y.name,c.querySelector(".shipping-cost").textContent=y.price,i.insertAdjacentHTML("beforeend",c.innerHTML)}),l.classList.remove("loading")})})}})();
